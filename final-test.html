<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ç»ˆæµ‹è¯• - ç›´æ¥å¤ç°ä¸»åº”ç”¨é€»è¾‘</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .debug-info { 
            position: fixed; top: 10px; right: 10px; 
            background: white; border: 2px solid #007bff; 
            padding: 15px; border-radius: 8px; 
            max-width: 400px; z-index: 9999; 
        }
        .status { margin: 5px 0; padding: 5px; border-radius: 3px; }
        .status.success { background: #d4edda; }
        .status.error { background: #f8d7da; }
        .status.info { background: #d1ecf1; }
        main { margin-right: 420px; }
    </style>
</head>
<body>
    <div id="app">
        <div class="debug-info">
            <h3>ğŸ” å®æ—¶çŠ¶æ€ç›‘æ§</h3>
            <div id="statusContainer"></div>
        </div>

        <!-- ç®€åŒ–çš„å¯¼èˆªæ  -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <a href="#">ä¼˜é€‰å•†åŸ (æœ€ç»ˆæµ‹è¯•)</a>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <div class="home">
                <div class="hero">
                    <h1>æ¬¢è¿æ¥åˆ°ä¼˜é€‰å•†åŸ (æœ€ç»ˆæµ‹è¯•ç‰ˆ)</h1>
                    <p>å‘ç°å“è´¨ç”Ÿæ´»ï¼Œäº«å—è´­ç‰©ä¹è¶£</p>
                    <button @click="loadData" class="btn btn-primary">é‡æ–°åŠ è½½æ•°æ®</button>
                </div>
                
                <section class="featured-products">
                    <h2>ç²¾é€‰äº§å“</h2>
                    <div class="products-grid" v-if="products.length > 0">
                        <div v-for="product in products" :key="product.id" class="product-card">
                            <div class="product-image"></div>
                            <div class="product-info">
                                <h3 class="product-title">{{ product.name }}</h3>
                                <p class="product-description">{{ product.description }}</p>
                                <div class="product-price">Â¥{{ product.price.toFixed(2) }}</div>
                                <div style="background: #28a745; color: white; padding: 5px; border-radius: 3px; margin: 5px 0;">
                                    ğŸ¯ æ•°æ®æº: {{ dataSource }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-else class="loading">
                        <p>{{ loading ? 'åŠ è½½ç²¾é€‰äº§å“ä¸­...' : 'æ²¡æœ‰æ‰¾åˆ°äº§å“' }}</p>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        // ä¸ä¸»åº”ç”¨å®Œå…¨ç›¸åŒçš„é…ç½®
        const SUPABASE_URL = 'https://nysrxrlwrlcfrbhutwtd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55c3J4cmx3cmxjZnJiaHV0d3RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4MTQ4MzgsImV4cCI6MjA3OTM5MDgzOH0.598J9S18JqKaqYP5e1lR_oKtly0pyhCzZ3FRJS0rwRI';
        
        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // æ¨¡æ‹Ÿæ•°æ®ï¼ˆä¸ä¸»åº”ç”¨ç›¸åŒï¼‰
        const mockProducts = [
            {
                id: 'mock-1',
                name: 'æ™ºèƒ½æ‰‹æœº Pro Max (æ¨¡æ‹Ÿ)',
                description: 'æœ€æ–°æ¬¾æ™ºèƒ½æ‰‹æœºï¼Œé…å¤‡é«˜æ¸…æ‘„åƒå¤´å’Œå¼ºå¤§å¤„ç†å™¨',
                price: 4999.00,
                featured: true
            },
            {
                id: 'mock-2',
                name: 'ç¬”è®°æœ¬ç”µè„‘ Ultra (æ¨¡æ‹Ÿ)',
                description: 'è½»è–„ä¾¿æºçš„é«˜æ€§èƒ½ç¬”è®°æœ¬ç”µè„‘',
                price: 7999.00,
                featured: true
            }
        ];

        function updateStatus(message, type = 'info') {
            const container = document.getElementById('statusContainer');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        const app = createApp({
            setup() {
                const products = ref([]);
                const loading = ref(true);
                const dataSource = ref('æœªçŸ¥');

                const loadData = async () => {
                    updateStatus('ğŸ”„ å¼€å§‹åŠ è½½ç²¾é€‰äº§å“...', 'info');
                    loading.value = true;

                    try {
                        // ä¸ä¸»åº”ç”¨å®Œå…¨ç›¸åŒçš„æŸ¥è¯¢
                        const { data, error } = await supabase
                            .from('products')
                            .select('*')
                            .eq('featured', true)
                            .limit(6);

                        updateStatus(`ğŸ“Š Supabase æŸ¥è¯¢å®Œæˆ: ${data?.length || 0} ä¸ªäº§å“, é”™è¯¯: ${error ? error.message : 'æ— '}`, 'info');

                        if (error) {
                            updateStatus(`âŒ Supabase é”™è¯¯: ${error.message}`, 'error');
                            products.value = mockProducts.filter(p => p.featured);
                            dataSource.value = 'æ¨¡æ‹Ÿæ•°æ® (å› é”™è¯¯)';
                        } else if (data && data.length > 0) {
                            updateStatus(`âœ… ä½¿ç”¨çœŸå®æ•°æ®: ${data.length} ä¸ªç²¾é€‰äº§å“`, 'success');
                            products.value = data;
                            dataSource.value = 'çœŸå® Supabase æ•°æ®';
                            
                            // æ˜¾ç¤ºäº§å“è¯¦æƒ…
                            data.forEach((product, index) => {
                                updateStatus(`äº§å“${index + 1}: ${product.name}`, 'success');
                            });
                        } else {
                            updateStatus('âš ï¸ æ²¡æœ‰ç²¾é€‰äº§å“ï¼Œå°è¯•åŠ è½½æ™®é€šäº§å“...', 'info');
                            
                            const { data: regularData, error: regularError } = await supabase
                                .from('products')
                                .select('*')
                                .limit(6);
                            
                            updateStatus(`ğŸ“Š æ™®é€šäº§å“æŸ¥è¯¢: ${regularData?.length || 0} ä¸ªäº§å“, é”™è¯¯: ${regularError ? regularError.message : 'æ— '}`, 'info');
                            
                            if (!regularError && regularData && regularData.length > 0) {
                                updateStatus(`âœ… ä½¿ç”¨æ™®é€šäº§å“: ${regularData.length} ä¸ªäº§å“`, 'success');
                                products.value = regularData;
                                dataSource.value = 'æ™®é€šäº§å“æ•°æ® (å¤‡ç”¨)';
                            } else {
                                updateStatus('âš ï¸ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®', 'error');
                                products.value = mockProducts.filter(p => p.featured);
                                dataSource.value = 'æ¨¡æ‹Ÿæ•°æ® (æ— æ•°æ®åº“æ•°æ®)';
                            }
                        }
                    } catch (error) {
                        updateStatus(`âŒ åŠ è½½å¼‚å¸¸: ${error.message}`, 'error');
                        products.value = mockProducts.filter(p => p.featured);
                        dataSource.value = 'æ¨¡æ‹Ÿæ•°æ® (å› å¼‚å¸¸)';
                    } finally {
                        loading.value = false;
                        updateStatus(`âœ… åŠ è½½å®Œæˆ: ${products.value.length} ä¸ªäº§å“, æ•°æ®æº: ${dataSource.value}`, 'success');
                    }
                };

                onMounted(() => {
                    updateStatus('ğŸš€ ç»„ä»¶å·²æŒ‚è½½ï¼Œå¼€å§‹è‡ªåŠ¨åŠ è½½...', 'info');
                    setTimeout(loadData, 1000);
                });

                return {
                    products,
                    loading,
                    dataSource,
                    loadData
                };
            }
        });

        app.mount('#app');
        updateStatus('âœ… Vue åº”ç”¨å·²æŒ‚è½½', 'success');
    </script>
</body>
</html>