<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•è°ƒè¯•æµ‹è¯•</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log-panel { 
            position: fixed; top: 10px; right: 10px; 
            width: 500px; height: 400px; 
            background: #f8f9fa; border: 2px solid #333; 
            border-radius: 8px; padding: 15px; 
            overflow-y: auto; font-family: monospace; font-size: 12px; 
        }
        .log { margin: 5px 0; padding: 5px; border-radius: 3px; }
        .log.info { background: #d1ecf1; }
        .log.success { background: #d4edda; }
        .log.error { background: #f8d7da; }
        .log.warning { background: #fff3cd; }
        .test-area { margin-right: 520px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="log-panel" id="logPanel">
        <div class="log info">ğŸš€ è°ƒè¯•é¡µé¢å·²åŠ è½½</div>
    </div>

    <div class="test-area">
        <h1>ğŸ§ª ç®€å• Supabase è°ƒè¯•æµ‹è¯•</h1>
        
        <button onclick="testStep1()">æ­¥éª¤1: æµ‹è¯•å®¢æˆ·ç«¯åˆ›å»º</button>
        <button onclick="testStep2()">æ­¥éª¤2: æµ‹è¯•è¡¨è®¿é—®</button>
        <button onclick="testStep3()">æ­¥éª¤3: æµ‹è¯•ç²¾é€‰äº§å“æŸ¥è¯¢</button>
        <button onclick="testStep4()">æ­¥éª¤4: æµ‹è¯•æ‰€æœ‰äº§å“æŸ¥è¯¢</button>
        <button onclick="runAllSteps()">ğŸš€ è¿è¡Œæ‰€æœ‰æ­¥éª¤</button>
        <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>

        <div id="testResults"></div>
    </div>

    <script>
        function addLog(message, type = 'info') {
            const logPanel = document.getElementById('logPanel');
            const log = document.createElement('div');
            log.className = `log ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            log.textContent = `[${timestamp}] ${message}`;
            logPanel.appendChild(log);
            logPanel.scrollTop = logPanel.scrollHeight;
        }

        function addResult(title, content) {
            const results = document.getElementById('testResults');
            const result = document.createElement('div');
            result.className = 'result';
            result.innerHTML = `<strong>${title}</strong><br>${content}`;
            results.appendChild(result);
        }

        function clearLogs() {
            document.getElementById('logPanel').innerHTML = '';
            document.getElementById('testResults').innerHTML = '';
        }

        // Supabase é…ç½®
        const SUPABASE_URL = 'https://nysrxrlwrlcfrbhutwtd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55c3J4cmx3cmxjZnJiaHV0d3RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4MTQ4MzgsImV4cCI6MjA3OTM5MDgzOH0.598J9S18JqKaqYP5e1lR_oKtly0pyhCzZ3FRJS0rwRI';

        let supabase = null;

        async function testStep1() {
            addLog('ğŸ”§ æ­¥éª¤1: æµ‹è¯•å®¢æˆ·ç«¯åˆ›å»º', 'info');
            
            try {
                const { createClient } = window.supabase;
                supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                addLog('âœ… Supabase å®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ', 'success');
                addResult('æ­¥éª¤1ç»“æœ', `å®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ<br>URL: ${SUPABASE_URL}<br>çŠ¶æ€: å·²åˆå§‹åŒ–`);
                
            } catch (error) {
                addLog(`âŒ å®¢æˆ·ç«¯åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                addResult('æ­¥éª¤1ç»“æœ', `âŒ åˆ›å»ºå¤±è´¥: ${error.message}`);
            }
        }

        async function testStep2() {
            addLog('ğŸ“Š æ­¥éª¤2: æµ‹è¯•è¡¨è®¿é—®', 'info');
            
            if (!supabase) {
                addLog('âŒ è¯·å…ˆè¿è¡Œæ­¥éª¤1åˆ›å»ºå®¢æˆ·ç«¯', 'error');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('count');
                
                if (error) {
                    addLog(`âŒ è¡¨è®¿é—®å¤±è´¥: ${error.message}`, 'error');
                    addResult('æ­¥éª¤2ç»“æœ', `âŒ è¡¨è®¿é—®å¤±è´¥: ${error.message}<br>é”™è¯¯ä»£ç : ${error.code}`);
                } else {
                    addLog('âœ… products è¡¨è®¿é—®æˆåŠŸ', 'success');
                    addResult('æ­¥éª¤2ç»“æœ', `âœ… products è¡¨å¯ä»¥æ­£å¸¸è®¿é—®<br>æŸ¥è¯¢ç»“æœ: ${JSON.stringify(data)}`);
                }
                
            } catch (error) {
                addLog(`âŒ è¡¨è®¿é—®å¼‚å¸¸: ${error.message}`, 'error');
                addResult('æ­¥éª¤2ç»“æœ', `âŒ å¼‚å¸¸: ${error.message}`);
            }
        }

        async function testStep3() {
            addLog('â­ æ­¥éª¤3: æµ‹è¯•ç²¾é€‰äº§å“æŸ¥è¯¢', 'info');
            
            if (!supabase) {
                addLog('âŒ è¯·å…ˆè¿è¡Œæ­¥éª¤1åˆ›å»ºå®¢æˆ·ç«¯', 'error');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('featured', true)
                    .limit(6);
                
                addLog(`ğŸ“Š ç²¾é€‰äº§å“æŸ¥è¯¢ç»“æœ: data=${data?.length || 0} items, error=${error ? error.message : 'none'}`, 'info');
                
                if (error) {
                    addLog(`âŒ ç²¾é€‰äº§å“æŸ¥è¯¢å¤±è´¥: ${error.message}`, 'error');
                    addResult('æ­¥éª¤3ç»“æœ', `âŒ æŸ¥è¯¢å¤±è´¥: ${error.message}<br>è¿™å¯èƒ½æ˜¯ä¸»åº”ç”¨ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®çš„åŸå› ï¼`);
                } else if (data && data.length > 0) {
                    addLog(`âœ… æ‰¾åˆ° ${data.length} ä¸ªç²¾é€‰äº§å“`, 'success');
                    addResult('æ­¥éª¤3ç»“æœ', `âœ… æˆåŠŸæ‰¾åˆ° ${data.length} ä¸ªç²¾é€‰äº§å“<br>ä¸»åº”ç”¨åº”è¯¥æ˜¾ç¤ºè¿™äº›æ•°æ®ï¼`);
                    data.forEach((product, index) => {
                        addLog(`äº§å“${index + 1}: ${product.name} - Â¥${product.price}`, 'success');
                    });
                } else {
                    addLog('âš ï¸ ç²¾é€‰äº§å“æŸ¥è¯¢è¿”å›ç©ºæ•°æ®', 'warning');
                    addResult('æ­¥éª¤3ç»“æœ', 'âš ï¸ æ²¡æœ‰ç²¾é€‰äº§å“æ•°æ®<br>è¿™æ˜¯ä¸»åº”ç”¨ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®çš„ä¸»è¦åŸå› ï¼');
                }
                
            } catch (error) {
                addLog(`âŒ ç²¾é€‰äº§å“æŸ¥è¯¢å¼‚å¸¸: ${error.message}`, 'error');
                addResult('æ­¥éª¤3ç»“æœ', `âŒ å¼‚å¸¸: ${error.message}`);
            }
        }

        async function testStep4() {
            addLog('ğŸ“¦ æ­¥éª¤4: æµ‹è¯•æ‰€æœ‰äº§å“æŸ¥è¯¢', 'info');
            
            if (!supabase) {
                addLog('âŒ è¯·å…ˆè¿è¡Œæ­¥éª¤1åˆ›å»ºå®¢æˆ·ç«¯', 'error');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .limit(6);
                
                addLog(`ğŸ“Š æ‰€æœ‰äº§å“æŸ¥è¯¢ç»“æœ: data=${data?.length || 0} items, error=${error ? error.message : 'none'}`, 'info');
                
                if (error) {
                    addLog(`âŒ æ‰€æœ‰äº§å“æŸ¥è¯¢å¤±è´¥: ${error.message}`, 'error');
                    addResult('æ­¥éª¤4ç»“æœ', `âŒ æŸ¥è¯¢å¤±è´¥: ${error.message}`);
                } else if (data && data.length > 0) {
                    addLog(`âœ… æ‰¾åˆ° ${data.length} ä¸ªäº§å“`, 'success');
                    addResult('æ­¥éª¤4ç»“æœ', `âœ… æ‰¾åˆ° ${data.length} ä¸ªäº§å“<br>è¿™äº›å¯ä»¥ä½œä¸ºå¤‡ç”¨æ•°æ®ä½¿ç”¨`);
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰äº§å“å¯ä»¥è®¾ä¸ºç²¾é€‰
                    const nonFeatured = data.filter(p => !p.featured);
                    if (nonFeatured.length > 0) {
                        addLog(`ğŸ’¡ æœ‰ ${nonFeatured.length} ä¸ªäº§å“å¯ä»¥è®¾ä¸ºç²¾é€‰`, 'info');
                    }
                } else {
                    addLog('âš ï¸ æ‰€æœ‰äº§å“æŸ¥è¯¢è¿”å›ç©ºæ•°æ®', 'warning');
                    addResult('æ­¥éª¤4ç»“æœ', 'âš ï¸ æ•°æ®åº“ä¸­æ²¡æœ‰ä»»ä½•äº§å“ï¼<br>éœ€è¦æ‰§è¡Œ SQL è„šæœ¬æ’å…¥æ•°æ®');
                }
                
            } catch (error) {
                addLog(`âŒ æ‰€æœ‰äº§å“æŸ¥è¯¢å¼‚å¸¸: ${error.message}`, 'error');
                addResult('æ­¥éª¤4ç»“æœ', `âŒ å¼‚å¸¸: ${error.message}`);
            }
        }

        async function runAllSteps() {
            clearLogs();
            addLog('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•æ­¥éª¤', 'info');
            
            await testStep1();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testStep2();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testStep3();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testStep4();
            
            addLog('ğŸ æ‰€æœ‰æµ‹è¯•å®Œæˆ', 'info');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œ
        window.onload = () => {
            addLog('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡æµ‹è¯•', 'info');
        };
    </script>
</body>
</html>