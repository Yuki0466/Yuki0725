<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®æ—¶è°ƒè¯• - ä¸»åº”ç”¨</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 400px;
            max-height: 80vh;
            background: white;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
            z-index: 9999;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .debug-content {
            font-size: 12px;
            font-family: monospace;
            white-space: pre-wrap;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
        }
        .debug-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .debug-close {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            font-size: 18px;
            color: #999;
        }
        main {
            margin-right: 420px; /* ç»™è°ƒè¯•é¢æ¿ç•™ç©ºé—´ */
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- è°ƒè¯•é¢æ¿ -->
        <div class="debug-panel" id="debugPanel">
            <span class="debug-close" onclick="toggleDebug()">Ã—</span>
            <div class="debug-title">ğŸ” å®æ—¶è°ƒè¯•ä¿¡æ¯</div>
            <div id="debugContent" class="debug-content">
                ç­‰å¾…è°ƒè¯•ä¿¡æ¯...
            </div>
        </div>

        <!-- ä¸»åº”ç”¨å†…å®¹ -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <router-link to="/">ä¼˜é€‰å•†åŸ (è°ƒè¯•ç‰ˆ)</router-link>
                </div>
                <div class="nav-menu">
                    <router-link to="/" class="nav-link">é¦–é¡µ</router-link>
                    <router-link to="/products" class="nav-link">äº§å“</router-link>
                    <router-link to="/cart" class="nav-link">è´­ç‰©è½¦</router-link>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <router-view></router-view>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <p>&copy; 2024 ä¼˜é€‰å•†åŸ. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
            </div>
        </footer>
    </div>

    <script>
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        let debugLogs = [];
        
        function debugLog(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            if (data) {
                logEntry += '
' + JSON.stringify(data, null, 2);
            }
            debugLogs.push(logEntry);
            
            // ä¿æŒæœ€æ–°çš„20æ¡æ—¥å¿—
            if (debugLogs.length > 20) {
                debugLogs = debugLogs.slice(-20);
            }
            
            updateDebugPanel();
        }

        function updateDebugPanel() {
            const debugContent = document.getElementById('debugContent');
            if (debugContent) {
                debugContent.textContent = debugLogs.join('

---

');
                debugContent.scrollTop = debugContent.scrollHeight;
            }
        }

        function toggleDebug() {
            const panel = document.getElementById('debugPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // åˆå§‹åŒ–è°ƒè¯•
        debugLog('ğŸš€ è°ƒè¯•ç‰ˆæœ¬å¯åŠ¨');

        // Supabase é…ç½® - ä¸ä¸»åº”ç”¨ç›¸åŒ
        const SUPABASE_URL = 'https://nysrxrlwrlcfrbhutwtd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55c3J4cmx3cmxjZnJiaHV0d3RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4MTQ4MzgsImV4cCI6MjA3OTM5MDgzOH0.598J9S18JqKaqYP5e1lR_oKtly0pyhCzZ3FRJS0rwRI';

        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        debugLog('ğŸ“¡ Supabase å®¢æˆ·ç«¯åˆ›å»º', {
            url: SUPABASE_URL,
            keyExists: !!SUPABASE_ANON_KEY
        });

        // æ¨¡æ‹Ÿæ•°æ®
        const mockProducts = [
            {
                id: '1',
                name: 'æ™ºèƒ½æ‰‹æœº Pro Max',
                description: 'æœ€æ–°æ¬¾æ™ºèƒ½æ‰‹æœºï¼Œé…å¤‡é«˜æ¸…æ‘„åƒå¤´å’Œå¼ºå¤§å¤„ç†å™¨',
                price: 4999.00,
                category_name: 'ç”µå­äº§å“',
                image_url: '',
                stock: 50,
                featured: true
            },
            {
                id: '2',
                name: 'ç¬”è®°æœ¬ç”µè„‘ Ultra',
                description: 'è½»è–„ä¾¿æºçš„é«˜æ€§èƒ½ç¬”è®°æœ¬ç”µè„‘',
                price: 7999.00,
                category_name: 'ç”µå­äº§å“',
                image_url: '',
                stock: 30,
                featured: true
            }
        ];

        const mockCategories = [
            { id: '1', name: 'ç”µå­äº§å“' },
            { id: '2', name: 'æœè£…é‹åŒ…' }
        ];

        // é¦–é¡µç»„ä»¶ - å¢å¼ºè°ƒè¯•
        const HomePage = {
            template: `
                <div class="home">
                    <div class="hero">
                        <h1>æ¬¢è¿æ¥åˆ°ä¼˜é€‰å•†åŸ (è°ƒè¯•ç‰ˆ)</h1>
                        <p>å‘ç°å“è´¨ç”Ÿæ´»ï¼Œäº«å—è´­ç‰©ä¹è¶£</p>
                        <router-link to="/products" class="btn btn-primary">å¼€å§‹è´­ç‰©</router-link>
                    </div>
                    
                    <section class="featured-products">
                        <h2>ç²¾é€‰äº§å“</h2>
                        <div class="products-grid" v-if="featuredProducts.length > 0">
                            <div v-for="product in featuredProducts" :key="product.id" class="product-card">
                                <div class="product-image"></div>
                                <div class="product-info">
                                    <h3 class="product-title">{{ product.name }}</h3>
                                    <p class="product-description">{{ product.description }}</p>
                                    <div class="product-price">Â¥{{ product.price.toFixed(2) }}</div>
                                    <router-link :to="'/product/' + product.id" class="btn btn-primary">æŸ¥çœ‹è¯¦æƒ…</router-link>
                                </div>
                            </div>
                        </div>
                        <div v-else class="loading">
                            <p>{{ loading ? 'åŠ è½½ç²¾é€‰äº§å“ä¸­...' : 'æ²¡æœ‰æ‰¾åˆ°äº§å“' }}</p>
                        </div>
                    </section>
                </div>
            `,
            setup() {
                const featuredProducts = ref([]);
                const loading = ref(true);

                debugLog('ğŸ  é¦–é¡µç»„ä»¶å¼€å§‹åŠ è½½');

                    onMounted(async () => {
                        debugLog('ğŸ”„ onMounted é’©å­è¢«è°ƒç”¨');
                        debugLog('ğŸ“ å½“å‰è·¯ç”±: ' + window.location.pathname);
                    debugLog('ğŸ”„ å¼€å§‹åŠ è½½ç²¾é€‰äº§å“...');
                    
                    try {
                        const { data, error } = await supabase
                            .from('products')
                            .select('*')
                            .eq('featured', true)
                            .limit(6);

                        debugLog('ğŸ“Š Supabase æŸ¥è¯¢ç»“æœ', { data, error });

                        if (error) {
                            debugLog('âŒ Supabase é”™è¯¯', error.message);
                            debugLog('ğŸ”„ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®', 'å› ä¸º Supabase é”™è¯¯');
                            featuredProducts.value = mockProducts.filter(p => p.featured);
                        } else if (data && data.length > 0) {
                            debugLog('âœ… ä½¿ç”¨çœŸå®æ•°æ®', `æ‰¾åˆ° ${data.length} ä¸ªç²¾é€‰äº§å“`);
                            featuredProducts.value = data;
                        } else {
                            debugLog('âš ï¸ Supabase è¿”å›ç©ºæ•°æ®', 'å°è¯•åŠ è½½æ™®é€šäº§å“');
                            
                            const { data: regularData, error: regularError } = await supabase
                                .from('products')
                                .select('*')
                                .limit(6);
                            
                            debugLog('ğŸ“Š æ™®é€šäº§å“æŸ¥è¯¢ç»“æœ', { data: regularData, error: regularError });
                            
                            if (!regularError && regularData && regularData.length > 0) {
                                debugLog('âœ… ä½¿ç”¨æ™®é€šäº§å“æ•°æ®', `æ‰¾åˆ° ${regularData.length} ä¸ªäº§å“`);
                                featuredProducts.value = regularData;
                            } else {
                                debugLog('âš ï¸ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®', 'å› ä¸ºæ•°æ®åº“ä¸­æ²¡æœ‰äº§å“');
                                featuredProducts.value = mockProducts.filter(p => p.featured);
                            }
                        }
                    } catch (error) {
                        debugLog('âŒ åŠ è½½äº§å“æ—¶å‘ç”Ÿå¼‚å¸¸', error.message);
                        featuredProducts.value = mockProducts.filter(p => p.featured);
                    } finally {
                        loading.value = false;
                        debugLog('âœ… é¦–é¡µåŠ è½½å®Œæˆ', {
                            äº§å“æ•°é‡: featuredProducts.value.length,
                            æ˜¯å¦åŠ è½½: loading.value,
                            æ•°æ®æº: featuredProducts.value[0]?.id.startsWith('mock') ? 'æ¨¡æ‹Ÿæ•°æ®' : 'çœŸå®æ•°æ®'
                        });
                    }
                });

                return {
                    featuredProducts,
                    loading
                };
            }
        };

        // åˆ›å»ºè·¯ç”±å’Œåº”ç”¨
        const routes = [
            { path: '/', component: HomePage }
        ];

        const router = VueRouter.createRouter({
            history: VueRouter.createWebHistory(),
            routes
        });

        const app = Vue.createApp({
            setup() {
                return {};
            }
        });

        app.use(router);
        app.mount('#app');

        debugLog('âœ… Vue åº”ç”¨æŒ‚è½½å®Œæˆ');
        
        // æ·»åŠ è·¯ç”±å˜åŒ–ç›‘å¬
        router.afterEach(() => {
            debugLog('ğŸ›£ï¸ è·¯ç”±å˜åŒ–åˆ°: ' + window.location.pathname);
        });
    </script>
</body>
</html>