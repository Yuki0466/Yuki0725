<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼˜é€‰å•†åŸ - å“è´¨ç”Ÿæ´»ä»è¿™é‡Œå¼€å§‹</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="app">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <router-link to="/">ä¼˜é€‰å•†åŸ</router-link>
                </div>
                <div class="nav-menu">
                    <router-link to="/" class="nav-link">é¦–é¡µ</router-link>
                    <router-link to="/products" class="nav-link">äº§å“</router-link>
                    <router-link to="/cart" class="nav-link">è´­ç‰©è½¦</router-link>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <router-view></router-view>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <p>&copy; 2024 ä¼˜é€‰å•†åŸ. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
            </div>
        </footer>
    </div>

    <script>
        // Supabase é…ç½®
        const SUPABASE_URL = 'https://nysrxrlwrlcfrbhutwtd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55c3J4cmx3cmxjZnJiaHV0d3RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4MTQ4MzgsImV4cCI6MjA3OTM5MDgzOH0.598J9S18JqKaqYP5e1lR_oKtly0pyhCzZ3FRJS0rwRI';

        // åˆ›å»º Supabase å®¢æˆ·ç«¯
        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Vue.js åº”ç”¨
        const { createApp, ref, onMounted, computed } = Vue;
        const { createRouter, createWebHistory } = VueRouter;

        // æ¨¡æ‹Ÿæ•°æ®ï¼ˆå¤‡ç”¨ï¼‰
        const mockProducts = [
            {
                id: 'mock-1',
                name: 'æ™ºèƒ½æ‰‹æœº Pro Max (æ¨¡æ‹Ÿ)',
                description: 'æœ€æ–°æ¬¾æ™ºèƒ½æ‰‹æœºï¼Œé…å¤‡é«˜æ¸…æ‘„åƒå¤´å’Œå¼ºå¤§å¤„ç†å™¨',
                price: 4999.00,
                category_name: 'ç”µå­äº§å“',
                image_url: '',
                stock: 50,
                featured: true
            },
            {
                id: 'mock-2',
                name: 'ç¬”è®°æœ¬ç”µè„‘ Ultra (æ¨¡æ‹Ÿ)',
                description: 'è½»è–„ä¾¿æºçš„é«˜æ€§èƒ½ç¬”è®°æœ¬ç”µè„‘',
                price: 7999.00,
                category_name: 'ç”µå­äº§å“',
                image_url: '',
                stock: 30,
                featured: true
            }
        ];

        // é¦–é¡µç»„ä»¶ - ä¿®å¤ç‰ˆ
        const HomePage = {
            template: `
                <div class="home">
                    <div class="hero">
                        <h1>æ¬¢è¿æ¥åˆ°ä¼˜é€‰å•†åŸ</h1>
                        <p>å‘ç°å“è´¨ç”Ÿæ´»ï¼Œäº«å—è´­ç‰©ä¹è¶£</p>
                        <router-link to="/products" class="btn btn-primary">å¼€å§‹è´­ç‰©</router-link>
                    </div>
                    
                    <section class="featured-products">
                        <h2>ç²¾é€‰äº§å“</h2>
                        <div v-if="loading" class="loading">
                            <p>åŠ è½½ç²¾é€‰äº§å“ä¸­...</p>
                        </div>
                        <div v-else-if="featuredProducts.length > 0" class="products-grid">
                            <div v-for="product in featuredProducts" :key="product.id" class="product-card">
                                <div class="product-image"></div>
                                <div class="product-info">
                                    <h3 class="product-title">{{ product.name }}</h3>
                                    <p class="product-description">{{ product.description }}</p>
                                    <div class="product-price">Â¥{{ product.price.toFixed(2) }}</div>
                                    <div style="background: #28a745; color: white; padding: 5px; border-radius: 3px; margin: 5px 0; font-size: 12px;">
                                        ğŸ¯ {{ dataSource }}
                                    </div>
                                    <router-link :to="'/product/' + product.id" class="btn btn-primary">æŸ¥çœ‹è¯¦æƒ…</router-link>
                                </div>
                            </div>
                        </div>
                        <div v-else class="loading">
                            <p>æ²¡æœ‰æ‰¾åˆ°ç²¾é€‰äº§å“</p>
                        </div>
                    </section>
                </div>
            `,
            setup() {
                const featuredProducts = ref([]);
                const loading = ref(true);
                const dataSource = ref('æœªçŸ¥');

                onMounted(async () => {
                    console.log('ğŸ  é¦–é¡µç»„ä»¶å¼€å§‹åŠ è½½');
                    loading.value = true;

                    try {
                        // ç›´æ¥æŸ¥è¯¢ç²¾é€‰äº§å“
                        console.log('ğŸ” æŸ¥è¯¢ç²¾é€‰äº§å“...');
                        
                        const { data, error } = await supabase
                            .from('products')
                            .select('*')
                            .eq('featured', true)
                            .limit(6);

                        console.log('ğŸ“Š ç²¾é€‰äº§å“æŸ¥è¯¢ç»“æœ:', { data, error });

                        if (error) {
                            console.error('âŒ ç²¾é€‰äº§å“æŸ¥è¯¢é”™è¯¯:', error);
                            featuredProducts.value = mockProducts.filter(p => p.featured);
                            dataSource.value = 'æ¨¡æ‹Ÿæ•°æ® (æŸ¥è¯¢é”™è¯¯)';
                        } else if (data && data.length > 0) {
                            console.log('âœ… ä½¿ç”¨çœŸå®ç²¾é€‰äº§å“:', data.length, 'ä¸ª');
                            featuredProducts.value = data;
                            dataSource.value = 'çœŸå® Supabase æ•°æ®';
                        } else {
                            console.log('âš ï¸ æ²¡æœ‰ç²¾é€‰äº§å“ï¼ŒæŸ¥è¯¢æ‰€æœ‰äº§å“...');
                            
                            // æŸ¥è¯¢æ‰€æœ‰äº§å“ä½œä¸ºå¤‡ç”¨
                            const { data: allData, error: allError } = await supabase
                                .from('products')
                                .select('*')
                                .limit(6);

                            console.log('ğŸ“Š æ‰€æœ‰äº§å“æŸ¥è¯¢ç»“æœ:', { data: allData, error: allError });

                            if (!allError && allData && allData.length > 0) {
                                console.log('âœ… ä½¿ç”¨æ‰€æœ‰äº§å“:', allData.length, 'ä¸ª');
                                featuredProducts.value = allData;
                                dataSource.value = 'æ‰€æœ‰äº§å“æ•°æ® (å¤‡ç”¨)';
                            } else {
                                console.log('âš ï¸ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                                featuredProducts.value = mockProducts.filter(p => p.featured);
                                dataSource.value = 'æ¨¡æ‹Ÿæ•°æ® (æ— æ•°æ®åº“æ•°æ®)';
                            }
                        }
                    } catch (error) {
                        console.error('âŒ åŠ è½½å¼‚å¸¸:', error);
                        featuredProducts.value = mockProducts.filter(p => p.featured);
                        dataSource.value = 'æ¨¡æ‹Ÿæ•°æ® (å¼‚å¸¸)';
                    } finally {
                        loading.value = false;
                        console.log('âœ… é¦–é¡µåŠ è½½å®Œæˆ:', {
                            äº§å“æ•°é‡: featuredProducts.value.length,
                            æ•°æ®æº: dataSource.value
                        });
                    }
                });

                return {
                    featuredProducts,
                    loading,
                    dataSource
                };
            }
        };

        // äº§å“åˆ—è¡¨é¡µç»„ä»¶ - ç®€åŒ–ç‰ˆ
        const ProductsPage = {
            template: `
                <div class="products-page">
                    <h1>äº§å“åˆ—è¡¨</h1>
                    <div class="products-grid" v-if="products.length > 0">
                        <div v-for="product in products" :key="product.id" class="product-card">
                            <div class="product-image"></div>
                            <div class="product-info">
                                <h3 class="product-title">{{ product.name }}</h3>
                                <p class="product-description">{{ product.description }}</p>
                                <div class="product-price">Â¥{{ product.price.toFixed(2) }}</div>
                                <router-link :to="'/product/' + product.id" class="btn btn-primary">æŸ¥çœ‹è¯¦æƒ…</router-link>
                            </div>
                        </div>
                    </div>
                    <div v-else class="loading">
                        <p>åŠ è½½äº§å“ä¸­...</p>
                    </div>
                </div>
            `,
            setup() {
                const products = ref([]);
                const loading = ref(true);

                onMounted(async () => {
                    try {
                        const { data, error } = await supabase
                            .from('products')
                            .select('*');

                        if (error) {
                            console.error('äº§å“åˆ—è¡¨é”™è¯¯:', error);
                            products.value = mockProducts;
                        } else {
                            products.value = data || [];
                        }
                    } catch (error) {
                        console.error('äº§å“åˆ—è¡¨å¼‚å¸¸:', error);
                        products.value = mockProducts;
                    } finally {
                        loading.value = false;
                    }
                });

                return { products, loading };
            }
        };

        // è´­ç‰©è½¦é¡µé¢
        const CartPage = {
            template: `
                <div class="cart-page">
                    <h1>è´­ç‰©è½¦</h1>
                    <div class="cart-items">
                        <p>è´­ç‰©è½¦åŠŸèƒ½å¼€å‘ä¸­...</p>
                    </div>
                </div>
            `,
            setup() {
                return {};
            }
        };

        // åˆ›å»ºè·¯ç”±
        const routes = [
            { path: '/', component: HomePage },
            { path: '/products', component: ProductsPage },
            { path: '/cart', component: CartPage },
            { path: '/product/:id', component: ProductsPage } // ä¸´æ—¶é‡å®šå‘
        ];

        const router = createRouter({
            history: createWebHistory(),
            routes
        });

        // åˆ›å»ºåº”ç”¨
        const app = createApp({
            setup() {
                return {};
            }
        });

        app.use(router);
        app.mount('#app');

        console.log('âœ… ä¿®å¤ç‰ˆåº”ç”¨å·²å¯åŠ¨');
    </script>
</body>
</html>