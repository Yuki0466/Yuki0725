<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›´æ¥æµ‹è¯• - ä¸ä¸»åº”ç”¨ç›¸åŒçš„é€»è¾‘</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { margin: 10px 0; padding: 15px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ç›´æ¥æµ‹è¯• - å¤åˆ¶ä¸»åº”ç”¨é€»è¾‘</h1>
    
    <button onclick="testExactlyLikeMainApp()">å®Œå…¨æŒ‰ç…§ä¸»åº”ç”¨çš„é€»è¾‘æµ‹è¯•</button>
    <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
    
    <div id="results"></div>

    <script>
        // ä¸ä¸»åº”ç”¨å®Œå…¨ç›¸åŒçš„é…ç½®
        const SUPABASE_URL = 'https://nysrxrlwrlcfrbhutwtd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55c3J4cmx3cmxjZnJiaHV0d3RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4MTQ4MzgsImV4cCI6MjA3OTM5MDgzOH0.598J9S18JqKaqYP5e1lR_oKtly0pyhCzZ3FRJS0rwRI';
        
        // ä¸ä¸»åº”ç”¨å®Œå…¨ç›¸åŒçš„å®¢æˆ·ç«¯åˆ›å»º
        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        const results = document.getElementById('results');

        function addResult(title, message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${title}</strong><br>${message}`;
            results.appendChild(div);
        }

        function addJsonResult(title, data, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${title}</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
            results.appendChild(div);
        }

        async function testExactlyLikeMainApp() {
            addResult('ğŸ”„ å¼€å§‹æµ‹è¯•', 'ä½¿ç”¨ä¸ä¸»åº”ç”¨å®Œå…¨ç›¸åŒçš„é€»è¾‘...', 'info');
            
            try {
                addResult('1ï¸âƒ£ æ­¥éª¤ 1', 'åˆ›å»º Supabase å®¢æˆ·ç«¯', 'info');
                
                // éªŒè¯å®¢æˆ·ç«¯
                if (!supabase) {
                    throw new Error('Supabase å®¢æˆ·ç«¯åˆ›å»ºå¤±è´¥');
                }
                
                addResult('âœ… æ­¥éª¤ 1', 'å®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ', 'success');

                addResult('2ï¸âƒ£ æ­¥éª¤ 2', 'æŸ¥è¯¢ç²¾é€‰äº§å“ (featured=true)...', 'info');
                
                // ä¸ä¸»åº”ç”¨å®Œå…¨ç›¸åŒçš„æŸ¥è¯¢
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('featured', true)
                    .limit(6);

                console.log('ä¸ä¸»åº”ç”¨ç›¸åŒçš„æŸ¥è¯¢ç»“æœ:', { data, error });
                addJsonResult('æŸ¥è¯¢ç»“æœ', { data, error }, 'info');

                if (error) {
                    addResult('âŒ æ­¥éª¤ 2', `ç²¾é€‰äº§å“æŸ¥è¯¢å¤±è´¥: ${error.message}`, 'error');
                    
                    // å¦‚æœç²¾é€‰äº§å“å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢æ‰€æœ‰äº§å“ï¼ˆåƒä¸»åº”ç”¨çš„å¤‡é€‰é€»è¾‘ï¼‰
                    addResult('3ï¸âƒ£ æ­¥éª¤ 3', 'å°è¯•æŸ¥è¯¢æ‰€æœ‰äº§å“ä½œä¸ºå¤‡é€‰...', 'info');
                    
                    const { data: allData, error: allError } = await supabase
                        .from('products')
                        .select('*')
                        .limit(6);

                    addJsonResult('æ‰€æœ‰äº§å“æŸ¥è¯¢ç»“æœ', { data: allData, error: allError }, 'info');

                    if (allError) {
                        addResult('âŒ æ­¥éª¤ 3', `æ‰€æœ‰äº§å“æŸ¥è¯¢ä¹Ÿå¤±è´¥: ${allError.message}`, 'error');
                    } else if (allData && allData.length > 0) {
                        addResult(`âœ… æ­¥éª¤ 3`, `æ‰¾åˆ° ${allData.length} ä¸ªæ™®é€šäº§å“ï¼Œå¯ä»¥æ›¿ä»£ç²¾é€‰äº§å“`, 'success');
                        addJsonResult('å¯ç”¨çš„äº§å“æ•°æ®', allData, 'success');
                    } else {
                        addResult('âš ï¸ æ­¥éª¤ 3', 'æ•°æ®åº“ä¸­æ²¡æœ‰ä»»ä½•äº§å“æ•°æ®', 'error');
                    }
                    
                } else if (data && data.length > 0) {
                    addResult(`âœ… æ­¥éª¤ 2`, `å®Œç¾ï¼æ‰¾åˆ° ${data.length} ä¸ªç²¾é€‰äº§å“`, 'success');
                    addJsonResult('ç²¾é€‰äº§å“æ•°æ®', data, 'success');
                } else {
                    addResult('âš ï¸ æ­¥éª¤ 2', 'ç²¾é€‰äº§å“æŸ¥è¯¢æˆåŠŸä½†è¿”å›ç©ºæ•°æ®', 'warning');
                }

                addResult('4ï¸âƒ£ æ­¥éª¤ 4', 'æµ‹è¯•åˆ†ç±»æ•°æ®...', 'info');
                
                const { data: catData, error: catError } = await supabase
                    .from('categories')
                    .select('*')
                    .limit(5);

                if (catError) {
                    addResult('âŒ æ­¥éª¤ 4', `åˆ†ç±»æŸ¥è¯¢å¤±è´¥: ${catError.message}`, 'error');
                } else if (catData && catData.length > 0) {
                    addResult(`âœ… æ­¥éª¤ 4`, `æ‰¾åˆ° ${catData.length} ä¸ªåˆ†ç±»`, 'success');
                    addJsonResult('åˆ†ç±»æ•°æ®', catData, 'info');
                } else {
                    addResult('âš ï¸ æ­¥éª¤ 4', 'åˆ†ç±»æ•°æ®ä¸ºç©º', 'warning');
                }

            } catch (error) {
                addResult('âŒ æµ‹è¯•å¼‚å¸¸', `æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸: ${error.message}`, 'error');
                console.error('æµ‹è¯•å¼‚å¸¸:', error);
            }
        }

        function clearResults() {
            results.innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = () => {
            setTimeout(testExactlyLikeMainApp, 1000);
        };
    </script>
</body>
</html>